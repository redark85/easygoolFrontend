<div class="create-match-dialog">
  <div class="modal-header">
    <h2 mat-dialog-title>
      <mat-icon>sports_soccer</mat-icon>
      <strong class="view-create-match">Crear Partido - </strong>{{ data.matchDayName }}
    </h2>
    <button mat-icon-button
            class="close-btn"
            (click)="onCancel()"
            [disabled]="isLoading">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-progress-spinner
        diameter="40"
        mode="indeterminate">
      </mat-progress-spinner>
      <p class="loading-text">Cargando equipos disponibles...</p>
    </div>

    <!-- Content when loaded -->
    <div *ngIf="!isLoading">

      <!-- Selection Summary -->
      <div class="selection-summary" *ngIf="selectedHomeTeam || selectedAwayTeam">
        <div class="summary-item">
          <span class="summary-label">Equipo Local:</span>
          <span class="summary-value">{{ selectedHomeTeam?.name || 'No seleccionado' }}</span>
        </div>
        <div class="summary-vs">VS</div>
        <div class="summary-item">
          <span class="summary-label">Equipo Visitante:</span>
          <span class="summary-value">{{ selectedAwayTeam?.name || 'No seleccionado' }}</span>
        </div>
      </div>

      <mat-divider *ngIf="selectedHomeTeam || selectedAwayTeam"></mat-divider>

      <!-- No Teams Available -->
      <div *ngIf="availableTeams.length === 0" class="no-teams">
        <mat-icon class="no-teams-icon">groups_off</mat-icon>
        <h3>No hay equipos disponibles</h3>
        <p>Todos los equipos ya tienen partidos asignados en esta jornada.</p>
      </div>

      <!-- Teams List -->
      <div *ngIf="availableTeams.length > 0" class="teams-section">
        <h3 class="section-title">Selecciona los equipos para el partido:</h3>

        <!-- Fecha y Hora del Partido - Solo si hay equipos disponibles -->
        <div class="datetime-section" *ngIf="isFormInitialized()">
          <h4 class="datetime-title">Fecha y Hora del Partido</h4>
          <form [formGroup]="matchForm">
            <div class="container-fluid">
              <div class="row">
                <!-- Campo de Fecha -->
                <div class="col-md-6 col-12 mb-3">
                  <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Fecha del Partido</mat-label>
                    <input matInput
                           [matDatepicker]="datePicker"
                           formControlName="matchDate"
                           [min]="minDate"
                           placeholder="Seleccionar fecha"
                           readonly>
                    <mat-datepicker-toggle matIconSuffix [for]="datePicker">
                      <mat-icon matDatepickerToggleIcon>calendar_today</mat-icon>
                    </mat-datepicker-toggle>
                    <mat-datepicker #datePicker
                                    [touchUi]="false"
                                    [disabled]="false"
                                    [restoreFocus]="true"
                                    (dateChange)="onDateSelected($event)">
                    </mat-datepicker>
                    <mat-error *ngIf="matchForm.get('matchDate')?.hasError('required')">
                      La fecha es requerida
                    </mat-error>
                  </mat-form-field>
                </div>

                <!-- Campo de Hora -->
                <div class="col-md-6 col-12 mb-3">
                  <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Hora del Partido</mat-label>
                    <input matInput
                           [matTimepicker]="timePicker"
                           formControlName="matchTime"
                           placeholder="Seleccionar hora"
                           readonly>
                    <mat-timepicker-toggle matIconSuffix [for]="timePicker">
                      <mat-icon matTimepickerToggleIcon>access_time</mat-icon>
                    </mat-timepicker-toggle>
                    <mat-timepicker #timePicker interval="15m"></mat-timepicker>
                    <mat-error *ngIf="matchForm.get('matchTime')?.hasError('required')">
                      La hora es requerida
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div class="teams-list">
          <div *ngFor="let team of availableTeams; trackBy: trackByTeamId"
               class="team-item">

            <div class="team-avatar">
              <img [src]="getTeamImageUrl(team)"
                   [alt]="team.name"
                   class="team-logo"
                   (error)="$event.target.src='assets/logo.png'">
            </div>

            <div class="team-info">
              <div class="team-name">{{ team.name }}</div>
              <div class="team-short-name">{{ team.shortName }}</div>
            </div>

            <div class="team-actions">
              <button mat-raised-button
                      [color]="isHomeTeamSelected(team) ? 'primary' : 'default'"
                      (click)="selectHomeTeam(team)"
                      [disabled]="isAwayTeamSelected(team)"
                      class="select-button home-button"
                      [matTooltip]="isHomeTeamSelected(team) ? '✓ Local' : 'Local'"
                      matTooltipPosition="above">
                <mat-icon>home</mat-icon>
                <span class="button-text">{{ isHomeTeamSelected(team) ? '✓ Local' : 'Local' }}</span>
              </button>

              <button mat-raised-button
                      [color]="isAwayTeamSelected(team) ? 'accent' : 'default'"
                      (click)="selectAwayTeam(team)"
                      [disabled]="isHomeTeamSelected(team)"
                      class="select-button away-button"
                      [matTooltip]="isAwayTeamSelected(team) ? '✓ Visitante' : 'Visitante'"
                      matTooltipPosition="above">
                <mat-icon>flight_takeoff</mat-icon>
                <span class="button-text">{{ isAwayTeamSelected(team) ? '✓ Visitante' : 'Visitante' }}</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end" class="dialog-actions">
    <button mat-button
            (click)="onCancel()"
            class="cancel-button">
      Cancelar
    </button>

    <button mat-raised-button
            color="primary"
            (click)="onConfirm()"
            [disabled]="!canConfirm() || isLoading"
            class="confirm-button">
      <mat-icon>add</mat-icon>
      Crear Partido
    </button>
  </mat-dialog-actions>
</div>
