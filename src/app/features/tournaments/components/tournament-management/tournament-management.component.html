<div class="tournament-management-container">
  <!-- Loading Spinner -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p class="loading-text">Cargando información del torneo...</p>
  </div>

  <!-- Tournament Management Content -->
  <div *ngIf="!isLoading && tournament" class="management-content">

    <!-- Tournament Info Banner -->
    <div class="tournament-banner">
      <div class="banner-content">
        <!-- Avatar con badge -->
        <div class="tournament-avatar">
          <img [src]="tournament.imageUrl || 'assets/logo.png'"
               [alt]="tournament.name"
               class="avatar-image"
               (error)="$event.target.src='assets/logo.png'">

          <!-- Status Badge sobre la imagen -->
          <div class="status-badge"
               [class]="getStatusClass(tournament.status)"
               [matTooltip]="getStatusText(tournament.status)"
               matTooltipPosition="above">
            <mat-icon class="status-icon">{{ getStatusIcon(tournament.status) }}</mat-icon>
          </div>
        </div>

        <!-- Información principal -->
        <div class="tournament-info">
          <div class="tournament-header">
            <h1 class="tournament-name">{{ tournament.name }}</h1>
            <div class="modality-badge">
              <mat-icon class="modality-icon">{{ getModalityIcon(tournament.modality) }}</mat-icon>
              <span>{{ getModalityText(tournament.modality) }}</span>
            </div>
          </div>
          
          <!-- Menú desplegable solo para móvil (fuera del header) -->
          <div class="mobile-menu-container">
            <button mat-icon-button 
                    class="mobile-menu-trigger"
                    [matMenuTriggerFor]="mobileInfoMenu"
                    matTooltip="Ver más información"
                    matTooltipPosition="below">
              <mat-icon>more_vert</mat-icon>
            </button>
            
            <mat-menu #mobileInfoMenu="matMenu" class="mobile-info-menu" xPosition="before" yPosition="below">
              <div class="mobile-menu-content" (click)="$event.stopPropagation()">
                <!-- Modalidad (igual que en web) -->
                <div class="mobile-menu-item">
                  <mat-icon class="modality-icon">{{ getModalityIcon(tournament.modality) }}</mat-icon>
                  <span class="menu-label">Modalidad:</span>
                  <span class="menu-value">{{ getModalityText(tournament.modality) }}</span>
                </div>
                
                <!-- Descripción (igual que en web) -->
                <div class="mobile-menu-item">
                  <mat-icon>description</mat-icon>
                  <span class="menu-label">Descripción:</span>
                  <p class="menu-value">{{ tournament.description }}</p>
                </div>
                
                <!-- Estadísticas (igual que en web) -->
                <div class="mobile-menu-item">
                  <mat-icon>groups</mat-icon>
                  <span class="menu-label">Equipos:</span>
                  <span class="menu-value">{{ tournament.totalTeams }} equipos</span>
                </div>
                
                <div class="mobile-menu-item">
                  <mat-icon>sports_soccer</mat-icon>
                  <span class="menu-label">Partidos:</span>
                  <span class="menu-value">{{ tournament.totalMatches }} partidos</span>
                </div>
                
                <div class="mobile-menu-item">
                  <mat-icon>event</mat-icon>
                  <span class="menu-label">Fechas:</span>
                  <span class="menu-value">{{ getDateRange() }}</span>
                </div>
                
                <!-- Controles de registro (exactamente igual que en web) -->
                <div class="mobile-menu-divider"></div>
                
                <div class="mobile-menu-item">
                  <mat-icon>settings</mat-icon>
                  <span class="menu-label">Registro:</span>
                  <div class="mobile-toggle-container">
                    <mat-slide-toggle
                      [checked]="!registrationClosed"
                      (change)="onRegistrationToggleChange($event)"
                      [disabled]="isUpdatingRegistration"
                      [matTooltip]="registrationClosed ? 'Registro cerrado - Los equipos no pueden registrarse' : 'Registro abierto - Los equipos pueden registrarse'"
                      matTooltipPosition="below"
                      class="registration-toggle mobile-menu-toggle">
                      <span class="toggle-label">
                        <mat-spinner *ngIf="isUpdatingRegistration" diameter="16" class="inline-spinner"></mat-spinner>
                        {{ registrationClosed ? 'Registro cerrado' : 'Registro abierto' }}
                      </span>
                    </mat-slide-toggle>
                  </div>
                </div>
                
                <!-- Botón copiar enlace (exactamente igual que en web) -->
                <div class="mobile-menu-item" *ngIf="tournament.tournamentLink && !registrationClosed">
                  <button type="button"
                          class="mobile-registration-link"
                          matTooltip="Enlace para registrarse al torneo"
                          matTooltipPosition="above"
                          (click)="copyRegistrationLink()">
                    <mat-icon>content_copy</mat-icon>
                    <span>Copiar enlace</span>
                  </button>
                </div>
              </div>
            </mat-menu>
          </div>
          
          <p class="tournament-description">{{ tournament.description }}</p>
        </div>

        <!-- Estadísticas compactas -->
        <div class="tournament-stats">
          <div class="stat-compact">
            <mat-icon>groups</mat-icon>
            <span class="stat-number">{{ tournament.totalTeams }}</span>
            <span class="stat-text">equipos</span>
          </div>
          <div class="stat-compact">
            <mat-icon>sports_soccer</mat-icon>
            <span class="stat-number">{{ tournament.totalMatches }}</span>
            <span class="stat-text">partidos</span>
          </div>
          <div class="stat-compact">
            <mat-icon>event</mat-icon>
            <span class="stat-text">{{ getDateRange() }}</span>
          </div>
        </div>

        <!-- Tournament Registration Controls -->
        <div class="tournament-actions">
          <!-- Switch para control de registro -->
          <div class="registration-control">
            <mat-slide-toggle
              [checked]="!registrationClosed"
              (change)="onRegistrationToggleChange($event)"
              [disabled]="isUpdatingRegistration"
              [matTooltip]="registrationClosed ? 'Registro cerrado - Los equipos no pueden registrarse' : 'Registro abierto - Los equipos pueden registrarse'"
              matTooltipPosition="below"
              class="registration-toggle">
              <span class="toggle-label">
                <mat-spinner *ngIf="isUpdatingRegistration" diameter="16" class="inline-spinner"></mat-spinner>
                {{ registrationClosed ? 'Registro cerrado' : 'Registro abierto' }}
              </span>
            </mat-slide-toggle>
          </div>

          <!-- Botón copiar enlace - Solo visible si registro está abierto -->
          <button type="button"
                  *ngIf="tournament.tournamentLink && !registrationClosed"
                  class="registration-link"
                  matTooltip="Enlace para registrarse al torneo"
                  matTooltipPosition="below"
                  (click)="copyRegistrationLink()">
            <mat-icon>content_copy</mat-icon>
            <span>Copiar enlace</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Tabs Navigation -->
    <mat-tab-group class="tournament-tabs"
                   [(selectedIndex)]="selectedTabIndex"
                   (selectedTabChange)="onTabChange($event)"
                   animationDuration="300ms">

      <!-- Tab 1: Fases -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">timeline</mat-icon>
          <span class="tab-text">Fases</span>
        </ng-template>

        <div class="tab-content">
          <app-phases-groups-management
            [tournamentId]="tournamentId"
            [phases]="phases"
            (phasesUpdated)="onPhasesUpdated($event)">
          </app-phases-groups-management>
        </div>
      </mat-tab>

      <!-- Tab 2: Equipos -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">groups</mat-icon>
          <span class="tab-text">Equipos</span>
        </ng-template>

        <div class="tab-content">
          <app-teams-management
            [tournamentId]="tournamentId"
            [teams]="teams"
            (teamsUpdated)="onTeamsUpdated($event)">
          </app-teams-management>
        </div>
      </mat-tab>

      <!-- Tab 3: Partidos -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">sports_soccer</mat-icon>
          <span class="tab-text">Partidos</span>
        </ng-template>

        <div class="tab-content">
          <app-matches-management
            [tournamentId]="tournamentId"
            [phases]="phases"
            [teams]="teams">
          </app-matches-management>
        </div>
      </mat-tab>

      <!-- Tab 4: Estadísticas -->
<!--      <mat-tab>-->
<!--        <ng-template mat-tab-label>-->
<!--          <mat-icon class="tab-icon">analytics</mat-icon>-->
<!--          <span class="tab-text">Estadísticas</span>-->
<!--        </ng-template>-->
<!--        -->
<!--        <div class="tab-content">-->
<!--          <app-statistics-management-->
<!--            [tournamentId]="tournamentId"-->
<!--            [tournament]="tournament"-->
<!--            [phases]="phases"-->
<!--            [teams]="teams">-->
<!--          </app-statistics-management>-->
<!--        </div>-->
<!--      </mat-tab>-->
    </mat-tab-group>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="!isLoading && !tournament">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <h3>Error al cargar el torneo</h3>
    <p>No se pudo encontrar la información del torneo solicitado</p>
    <button mat-raised-button
            color="primary"
            (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Volver a Torneos
    </button>
  </div>
</div>
