<div class="teams-management-container">
  <mat-card class="teams-management-card">
    <mat-card-header>
      <div class="container-fluid">
        <div class="row align-items-center">
          <div class="col-8">
            <mat-card-title>
              <mat-icon>groups</mat-icon>
              Equipos del Torneo
            </mat-card-title>
            <mat-card-subtitle>
              Administra los equipos participantes en tu torneo
            </mat-card-subtitle>
          </div>
          <div class="col-4">
            <div class="row justify-content-end">
              <div class="col-auto">
                <mat-form-field appearance="outline" class="search-field">
                  <mat-label>Buscar equipos</mat-label>
                  <input matInput
                         [(ngModel)]="searchTerm"
                         (input)="onSearchChange()"
                         placeholder="Nombre o nombre corto"
                         autocomplete="off">
                  <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-card-header>

    <mat-card-content>
      <!-- Floating Action Button for Teams -->
      <button mat-fab
              class="fab-fixed add-team-btn"
              (click)="createTeam()"
              matTooltip="Crear nuevo equipo">
        <mat-icon>add</mat-icon>
      </button>

      <!-- No Teams Message -->
      <div class="no-teams" *ngIf="filteredTeams.length === 0 && searchTerm === ''">
        <mat-icon class="no-teams-icon">groups</mat-icon>
        <h3>No hay equipos registrados</h3>
        <p>Comienza agregando el primer equipo a tu torneo</p>
      </div>

      <!-- No Search Results -->
      <div class="no-teams" *ngIf="filteredTeams.length === 0 && searchTerm !== ''">
        <mat-icon class="no-teams-icon">search_off</mat-icon>
        <h3>No se encontraron equipos</h3>
        <p>No hay equipos que coincidan con "{{ searchTerm }}"</p>
      </div>

      <!-- Teams List -->
      <div *ngIf="filteredTeams.length > 0" class="teams-list">
        <div *ngFor="let team of filteredTeams; trackBy: trackByTeamId" class="team-row">
          <div class="row align-items-center py-3 border-bottom">
            <!-- Avatar y Info Principal -->
            <div class="col-md-3 d-flex align-items-center">
              <div class="team-avatar me-3 position-relative">
                <img [src]="team.logoUrl || 'assets/logo.png'"
                     [alt]="team.name"
                     class="team-logo rounded-circle"
                     (error)="$event.target.src='assets/logo.png'"
                     width="50" height="50">
                
                <!-- Status Badge sobre la imagen -->
                <div [class]="getTeamStatusClass(team.status)"
                     [matTooltip]="getTeamStatusText(team.status)"
                     matTooltipPosition="above">
                  <mat-icon class="status-icon">{{ getTeamStatusIcon(team.status) }}</mat-icon>
                </div>
              </div>
              <div class="team-info">
                <h5 class="mb-1 fw-bold">{{ team.name }}</h5>
                <small class="text-muted">{{ team.shortName }}</small>
              </div>
            </div>

            <!-- Estadísticas -->
            <div class="col-3">
              <div class="row align-items-center">
                <div class="col-auto">
                  <mat-icon class="text-primary me-1">people</mat-icon>
                  <span class="badge bg-primary rounded-pill">{{ team.totalPlayers }}</span>
                </div>
                <div class="col-auto">
                  <small class="text-muted">Aqui nombre de Manager y phone</small>   <!-- Obtiene del objeto Manager -->
                </div>
              </div>
            </div>

            <!-- Switch y Controles -->
            <div class="col-2">
              <div class="row justify-content-center">
                <div class="col-auto">
                  <mat-slide-toggle
                    [checked]="team.allowPlayerRegistration || false"
                    (change)="onTogglePlayerRegistration(team, $event.checked)"
                    matTooltip="Permitir registro de jugadores"
                    class="registration-toggle">
                  </mat-slide-toggle>
                </div>
              </div>
            </div>

            <!-- Botones de Acción -->
            <div class="col-4">
              <div class="row justify-content-end">
                <div class="col-auto">
                  <div class="btn-group" role="group">
                    <button mat-icon-button
                            matTooltip="Agregar jugador"
                            class="text-success">
                      <mat-icon>person_add</mat-icon>
                    </button>
                    <button mat-icon-button
                            (click)="editTeam(team)"
                            matTooltip="Editar equipo"
                            class="text-primary">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button
                            (click)="deleteTeam(team)"
                            matTooltip="Eliminar equipo"
                            class="text-danger">
                      <mat-icon>delete</mat-icon>
                    </button>
                    <button   *ngIf="!team.hasExcelUploaded" mat-icon-button
                            matTooltip="Subir excel de registro de jugadores"
                            class="text-info">
                      <mat-icon>upload_file</mat-icon>
                    </button>
                    <button mat-icon-button
                            (click)="disqualifyTeam(team)"
                            [disabled]="!canDisqualifyTeam(team)"
                            [matTooltip]="canDisqualifyTeam(team) ? 'Descalificar equipo' : 'Equipo ya descalificado'"
                            [class]="canDisqualifyTeam(team) ? 'text-warning' : 'text-muted'">
                      <mat-icon>gavel</mat-icon>
                    </button>
                    <button mat-icon-button
                            *ngIf="!team.hasUsedLink"
                            (click)="copyRegistrationUrl(team.urlRegistration)"
                            matTooltip="Copiar URL de registro"
                            class="text-secondary">
                      <mat-icon>link</mat-icon>
                    </button>                  
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
