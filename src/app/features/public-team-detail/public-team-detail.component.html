<!-- Loading State -->
<app-public-loading 
  [isVisible]="isLoading"
  text="Cargando información del equipo..."
  subtext="Obteniendo datos desde el servidor"
  [diameter]="50"
  [strokeWidth]="3">
</app-public-loading>

<div class="public-team-detail-container">
  <!-- Team Detail Content - Always visible -->
  <div class="team-detail-content">
    <!-- Hero Section -->
    <section class="hero-section">
      <div class="hero-background">
        <img src="assets/wallpaper.jpg" alt="Background" class="wallpaper-image">
        <div class="hero-overlay"></div>
      </div>

      <!-- Back Button -->
      <div class="back-button-container">
        <button mat-icon-button class="back-button" (click)="goBack()" matTooltip="Volver atrás" matTooltipPosition="right">
          <mat-icon>arrow_back</mat-icon>
        </button>
      </div>

      <div class="container-fluid">
        <div class="row align-items-stretch">
          <!-- Left Column: Team Info (7 columns) -->
          <div class="col-lg-7">
            <div class="row align-items-center">
              <!-- Team Logo -->
              <div class="col-auto">
                <div class="fixture-icon-container">
                  <img [src]="team?.logoUrl || 'assets/default-team.png'" [alt]="team?.name || 'Equipo'" class="team-logo-hero" (error)="$event.target.src='assets/default-team.png'">
                </div>
              </div>

              <!-- Team Info -->
              <div class="col">
                <div class="fixture-info">
                  <div class="fixture-header">
                    <h1 class="fixture-title">{{ team?.name || 'Nombre del Equipo' }}</h1>
                    <p class="fixture-subtitle">{{ team?.motto || 'Información del Equipo' }}</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Stats Row - Estadísticas en fila inferior -->
            <div class="row mt-3">
              <div class="col-12">
                <div class="legend-items-hero">
                  <div class="legend-item-hero">
                    <div class="legend-badge">
                      <mat-icon>emoji_events</mat-icon>
                      {{ team?.position || 0 }}° Posición
                    </div>
                  </div>
                  <div class="legend-item-hero">
                    <div class="legend-badge">
                      <mat-icon>star</mat-icon>
                      {{ team?.points || 0 }} Puntos
                    </div>
                  </div>
                  <div class="legend-item-hero">
                    <div class="legend-badge">
                      <mat-icon>people</mat-icon>
                      {{ team?.totalPlayers || 0 }} Jugadores
                    </div>
                  </div>
                  <div class="legend-item-hero">
                    <div class="legend-badge">
                      <mat-icon>sports</mat-icon>
                      {{ team?.matchesPlayed || 0 }} Partidos
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Additional Info Row -->
            <div class="row mt-2">
              <div class="col-12">
                <div class="team-meta-hero">
                  <div class="meta-item-hero">
                    <mat-icon>sports_soccer</mat-icon>
                    <span>Fundado en {{ team?.founded || 'N/A' }}</span>
                  </div>
                  <div class="meta-item-hero">
                    <mat-icon>stadium</mat-icon>
                    <span>{{ team?.stadium || 'Estadio por definir' }}</span>
                  </div>
                  <div class="meta-item-hero">
                    <mat-icon>person</mat-icon>
                    <span>DT: {{ team?.coach || 'Por definir' }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Column: Team Summary (5 columns) -->
          <div class="col-lg-5 hero-right-section px-0">
            <div class="hero-right-content">
              <!-- Primera Fila -->
              <div class="row g-2 mb-3">
                <!-- Record Section -->
                <div class="col-6">
                  <div class="summary-section-mini record">
                    <h4>
                      <mat-icon>bar_chart</mat-icon>
                      Récord
                    </h4>
                    <div class="record-stats-mini">
                      <div class="stat-mini wins">
                        <span class="number-mini">{{ team?.wins || 0 }}</span>
                        <span class="label-mini">V</span>
                      </div>
                      <div class="stat-mini draws">
                        <span class="number-mini">{{ team?.draws || 0 }}</span>
                        <span class="label-mini">E</span>
                      </div>
                      <div class="stat-mini losses">
                        <span class="number-mini">{{ team?.losses || 0 }}</span>
                        <span class="label-mini">D</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Goals Section -->
                <div class="col-6">
                  <div class="summary-section-mini goals">
                    <h4>
                      <mat-icon>sports_soccer</mat-icon>
                      Goles
                    </h4>
                    <div class="goals-stats-mini">
                      <div class="stat-mini for">
                        <span class="number-mini">{{ team?.goalsFor || 0 }}</span>
                        <span class="label-mini">GF</span>
                      </div>
                      <div class="stat-mini against">
                        <span class="number-mini">{{ team?.goalsAgainst || 0 }}</span>
                        <span class="label-mini">GC</span>
                      </div>
                      <div class="stat-mini difference" [class.positive]="(team?.goalDifference || 0) > 0" [class.negative]="(team?.goalDifference || 0) < 0">
                        <span class="number-mini">{{ (team?.goalDifference || 0) > 0 ? '+' : '' }}{{ team?.goalDifference || 0 }}</span>
                        <span class="label-mini">DG</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Segunda Fila -->
              <div class="row g-2">
                <!-- Form Section -->
                <div class="col-6">
                  <div class="summary-section-mini form">
                    <h4>
                      <mat-icon>trending_up</mat-icon>
                      Forma
                    </h4>
                    <div class="form-badges-mini">
                      <div *ngFor="let result of team?.lastFiveResults || []" 
                           [class]="'result-badge-mini ' + getResultClass(result)"
                           [matTooltip]="result === 'W' ? 'Victoria' : result === 'D' ? 'Empate' : 'Derrota'">
                        {{ getResultText(result) }}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Quick Stats -->
                <div class="col-6">
                  <div class="summary-section-mini quick-stats">
                    <h4>
                      <mat-icon>analytics</mat-icon>
                      Stats
                    </h4>
                    <div class="quick-stats-grid-mini">
                      <div class="quick-stat-mini">
                        <span class="value-mini">{{ ((team?.points || 0) / (team?.matchesPlayed || 1)) | number:'1.1-1' }}</span>
                        <span class="label-mini">PPP</span>
                      </div>
                      <div class="quick-stat-mini">
                        <span class="value-mini">{{ getWinPercentage() | number:'1.0-0' }}%</span>
                        <span class="label-mini">Efect.</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Content Section -->
    <div class="main-content-section">
      <div class="container-fluid">
        <div class="row">
          <!-- Left Column: Team Roster (7 columns) -->
          <div class="col-lg-7">
            <div class="team-roster-section">
              <div class="roster-header">
                <h3>
                  <mat-icon>groups</mat-icon>
                  Plantilla Completa
                </h3>
                <p class="roster-count">{{ team?.totalPlayers || 0 }} jugadores registrados</p>
              </div>

              <div class="players-by-position">
                <div *ngFor="let position of positions" class="position-group">
                  <h4 class="position-title">
                    <mat-icon>
                      {{ position.value === 'GK' ? 'sports_handball' : 
                         position.value === 'DEF' ? 'shield' : 
                         position.value === 'MID' ? 'swap_horiz' : 'flash_on' }}
                    </mat-icon>
                    {{ position.name }}
                    <span class="player-count">({{ getPlayersByPosition(position.value).length }})</span>
                  </h4>
                  
                  <div class="players-list">
                    <div *ngFor="let player of getPlayersByPosition(position.value)" 
                         class="player-card">
                      <div class="player-number">{{ player.jerseyNumber }}</div>
                      <img [src]="player.photoUrl || 'assets/person.jpg'" [alt]="player.name" class="player-photo" (error)="$event.target.src='assets/person.jpg'">
                      <div class="player-info">
                        <span class="player-name">{{ player.name }}</span>
                        <span class="player-matches">{{ player.matchesPlayed }} PJ</span>
                      </div>
                      <div class="player-stats">
                        <span *ngIf="player.goals > 0" class="stat-badge goals" matTooltip="Goles">
                          ⚽ {{ player.goals }}
                        </span>
                        <span *ngIf="player.assists > 0" class="stat-badge assists" matTooltip="Asistencias">
                          🎯 {{ player.assists }}
                        </span>
                        <span *ngIf="player.yellowCards > 0" class="stat-badge yellow" matTooltip="Tarjetas Amarillas">
                          🟨 {{ player.yellowCards }}
                        </span>
                        <span *ngIf="player.redCards > 0" class="stat-badge red" matTooltip="Tarjetas Rojas">
                          🟥 {{ player.redCards }}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Column: Matches & Stats (5 columns) -->
          <div class="col-lg-5">
            <div class="right-column-content">
              <!-- Matches Section (Top Row) -->
              <div class="matches-section-mini">
                <div class="section-header">
                  <h4>
                    <mat-icon>event</mat-icon>
                    Partidos
                  </h4>
                </div>
                
                <div class="matches-content">
                  <!-- Upcoming Matches -->
                  <div class="matches-group" *ngIf="(team?.upcomingMatches?.length || 0) > 0">
                    <h5 class="group-title">Próximos</h5>
                    <div class="matches-list-mini">
                      <div *ngFor="let match of (team?.upcomingMatches || []).slice(0, 2)" 
                           class="match-item-mini upcoming"
                           (click)="viewMatchDetail(match.id)">
                        <div class="match-date-mini">
                          <span class="day">{{ match.date | date:'dd' }}</span>
                          <span class="month">{{ match.date | date:'MMM' }}</span>
                        </div>
                        <div class="match-info-mini">
                          <div class="match-teams-mini">
                            <span class="team-name">{{ match.isHome ? (team?.name || 'Equipo') : match.opponent }}</span>
                            <span class="vs">vs</span>
                            <span class="team-name">{{ match.isHome ? match.opponent : (team?.name || 'Equipo') }}</span>
                          </div>
                          <div class="match-venue-mini">
                            <mat-icon>{{ match.isHome ? 'home' : 'flight_takeoff' }}</mat-icon>
                            <span>{{ match.isHome ? 'Local' : 'Visitante' }}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Past Matches -->
                  <div class="matches-group" *ngIf="(team?.pastMatches?.length || 0) > 0">
                    <h5 class="group-title">Recientes</h5>
                    <div class="matches-list-mini">
                      <div *ngFor="let match of (team?.pastMatches || []).slice(0, 2)" 
                           class="match-item-mini finished"
                           (click)="viewMatchDetail(match.id)">
                        <div class="match-date-mini">
                          <span class="day">{{ match.date | date:'dd' }}</span>
                          <span class="month">{{ match.date | date:'MMM' }}</span>
                        </div>
                        <div class="match-info-mini">
                          <div class="match-teams-mini">
                            <span class="team-name">{{ match.isHome ? (team?.name || 'Equipo') : match.opponent }}</span>
                            <span class="score">{{ match.score }}</span>
                            <span class="team-name">{{ match.isHome ? match.opponent : (team?.name || 'Equipo') }}</span>
                          </div>
                        </div>
                        <div class="match-result-mini">
                          <div [class]="'result-badge-mini ' + getResultClass(match.result || 'D')">
                            {{ getResultText(match.result || 'D') }}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Statistics Section (Bottom Row) -->
              <div class="stats-section-mini">
                <div class="section-header">
                  <h4>
                    <mat-icon>insights</mat-icon>
                    Estadísticas
                  </h4>
                </div>
                
                <div class="stats-content">
                  <!-- Performance Stats -->
                  <div class="stats-grid-mini">
                    <div class="stat-card-mini">
                      <div class="stat-icon-mini wins">
                        <mat-icon>emoji_events</mat-icon>
                      </div>
                      <div class="stat-content-mini">
                        <span class="stat-value-mini">{{ team?.wins || 0 }}</span>
                        <span class="stat-label-mini">Victorias</span>
                      </div>
                    </div>

                    <div class="stat-card-mini">
                      <div class="stat-icon-mini goals">
                        <mat-icon>sports_soccer</mat-icon>
                      </div>
                      <div class="stat-content-mini">
                        <span class="stat-value-mini">{{ team?.goalsFor || 0 }}</span>
                        <span class="stat-label-mini">Goles</span>
                      </div>
                    </div>

                    <div class="stat-card-mini">
                      <div class="stat-icon-mini defense">
                        <mat-icon>shield</mat-icon>
                      </div>
                      <div class="stat-content-mini">
                        <span class="stat-value-mini">{{ team?.goalsAgainst || 0 }}</span>
                        <span class="stat-label-mini">Recibidos</span>
                      </div>
                    </div>

                    <div class="stat-card-mini">
                      <div class="stat-icon-mini points">
                        <mat-icon>star</mat-icon>
                      </div>
                      <div class="stat-content-mini">
                        <span class="stat-value-mini">{{ team?.points || 0 }}</span>
                        <span class="stat-label-mini">Puntos</span>
                      </div>
                    </div>
                  </div>

                  <!-- Top Player -->
                  <div class="top-player-mini" *ngIf="(team?.players?.length || 0) > 0">
                    <div class="player-highlight-mini">
                      <img [src]="team?.players?.[0]?.photoUrl || 'assets/person.jpg'" [alt]="team?.players?.[0]?.name || 'Jugador'" class="player-photo-mini" (error)="$event.target.src='assets/person.jpg'">
                      <div class="player-details-mini">
                        <span class="name-mini">{{ team?.players?.[0]?.name || 'Jugador destacado' }}</span>
                        <span class="stat-mini">{{ team?.players?.[0]?.goals || 0 }} goles</span>
                      </div>
                      <div class="player-badge-mini">
                        <mat-icon>sports_soccer</mat-icon>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
