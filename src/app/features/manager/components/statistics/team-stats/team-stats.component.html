<div class="team-stats-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <mat-icon>analytics</mat-icon>
        Estadísticas del Equipo
      </h1>
      <p class="page-subtitle">Análisis detallado del rendimiento del equipo</p>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <mat-card>
      <mat-card-content>
        <div class="loading-content">
          <mat-icon class="loading-icon">hourglass_empty</mat-icon>
          <h2>Cargando estadísticas...</h2>
          <p>Obteniendo datos del rendimiento del equipo</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- No Data State -->
  <!-- <div class="no-data-state" *ngIf="!isLoading && !hasData"> -->
  <div class="no-data-state" *ngIf="!isLoading && !hasData">

    <mat-card>
      <mat-card-content>
        <div class="no-data-content">
          <mat-icon class="no-data-icon">pending_actions</mat-icon>
          <h2>Datos Pendientes</h2>
          <p>Aún no se han cargado los datos del torneo.</p>
          <p class="no-data-description">
            Las estadísticas del equipo estarán disponibles una vez que se registren partidos y resultados en el torneo.
          </p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Stats Content -->
  <mat-tab-group class="stats-tabs" *ngIf="!isLoading && hasData && performanceData">
    <!-- Tab: Rendimiento General -->
    <mat-tab label="Rendimiento General">
      <div class="tab-content">
        <!-- Main Stats Grid -->
        <div class="main-stats-grid">
          <mat-card class="stat-card large">
            <mat-card-content>
              <div class="stat-header">
                <mat-icon>sports_soccer</mat-icon>
                <span class="stat-title">Partidos Jugados</span>
              </div>
              <div class="stat-value">{{ performanceData.played }}</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card wins">
            <mat-card-content>
              <div class="stat-header">
                <mat-icon>check_circle</mat-icon>
                <span class="stat-title">Victorias</span>
              </div>
              <div class="stat-value">{{ performanceData.wins }}</div>
              <div class="stat-percentage">{{ performanceData.winPercentage | number:'1.1-1' }}%</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card draws">
            <mat-card-content>
              <div class="stat-header">
                <mat-icon>remove_circle</mat-icon>
                <span class="stat-title">Empates</span>
              </div>
              <div class="stat-value">{{ performanceData.draws }}</div>
              <div class="stat-percentage">{{ performanceData.drawPercentage | number:'1.1-1' }}%</div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card losses">
            <mat-card-content>
              <div class="stat-header">
                <mat-icon>cancel</mat-icon>
                <span class="stat-title">Derrotas</span>
              </div>
              <div class="stat-value">{{ performanceData.losses }}</div>
              <div class="stat-percentage">{{ performanceData.lossPercentage | number:'1.1-1' }}%</div>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Results Distribution -->
        <mat-card class="distribution-card">
          <mat-card-header>
            <mat-card-title>Distribución de Resultados</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="distribution-bars">
              <div class="distribution-item">
                <span class="label">Victorias</span>
                <div class="bar-container">
                  <mat-progress-bar mode="determinate" [value]="performanceData.winPercentage" color="primary"></mat-progress-bar>
                </div>
                <span class="value">{{ performanceData.winPercentage | number:'1.0-0' }}%</span>
              </div>
              <div class="distribution-item">
                <span class="label">Empates</span>
                <div class="bar-container">
                  <mat-progress-bar mode="determinate" [value]="performanceData.drawPercentage" color="accent"></mat-progress-bar>
                </div>
                <span class="value">{{ performanceData.drawPercentage | number:'1.0-0' }}%</span>
              </div>
              <div class="distribution-item">
                <span class="label">Derrotas</span>
                <div class="bar-container">
                  <mat-progress-bar mode="determinate" [value]="performanceData.lossPercentage" color="warn"></mat-progress-bar>
                </div>
                <span class="value">{{ performanceData.lossPercentage | number:'1.0-0' }}%</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Goals Stats -->
        <div class="goals-stats-grid">
          <mat-card class="goals-card">
            <mat-card-content>
              <div class="goals-header">
                <mat-icon class="goals-for">sports_score</mat-icon>
                <span class="goals-title">Goles a Favor</span>
              </div>
              <div class="goals-value">{{ performanceData.goalsFor }}</div>
              <mat-divider></mat-divider>
              <div class="goals-average">
                <span class="average-label">Promedio por partido</span>
                <span class="average-value">{{ performanceData.avgGoalsFor | number:'1.1-1' }}</span>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="goals-card">
            <mat-card-content>
              <div class="goals-header">
                <mat-icon class="goals-against">sports_score</mat-icon>
                <span class="goals-title">Goles en Contra</span>
              </div>
              <div class="goals-value">{{ performanceData.goalsAgainst }}</div>
              <mat-divider></mat-divider>
              <div class="goals-average">
                <span class="average-label">Promedio por partido</span>
                <span class="average-value">{{ performanceData.avgGoalsAgainst | number:'1.1-1' }}</span>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="goals-card">
            <mat-card-content>
              <div class="goals-header">
                <mat-icon class="goal-diff">compare_arrows</mat-icon>
                <span class="goals-title">Diferencia de Goles</span>
              </div>
              <div class="goals-value" [class.positive]="performanceData.goalDifference > 0" [class.negative]="performanceData.goalDifference < 0">
                {{ performanceData.goalDifference > 0 ? '+' : '' }}{{ performanceData.goalDifference }}
              </div>
              <mat-divider></mat-divider>
              <div class="goals-average">
                <span class="average-label">Porterías a cero</span>
                <span class="average-value">{{ performanceData.cleanSheets }}</span>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="goals-card">
            <mat-card-content>
              <div class="goals-header">
                <mat-icon class="possession">timeline</mat-icon>
                <span class="goals-title">Posesión Promedio</span>
              </div>
              <div class="goals-value">N/A</div>
              <mat-divider></mat-divider>
              <div class="possession-bar">
                <mat-progress-bar mode="determinate" [value]="0" color="primary"></mat-progress-bar>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-tab>

    <!-- Tab: Análisis por Contexto -->
    <mat-tab label="Análisis por Contexto">
      <div class="tab-content">
        <!-- Home vs Away -->
        <mat-card class="context-card">
          <mat-card-header>
            <mat-card-title>Rendimiento Local vs Visitante</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="context-comparison">
              <!-- Home Stats -->
              <div class="context-section home">
                <div class="context-header">
                  <mat-icon>home</mat-icon>
                  <h3>Local</h3>
                </div>
                <div class="context-stats">
                  <div class="context-stat">
                    <span class="stat-label">Partidos</span>
                    <span class="stat-value">{{ performanceData.homePerformance? performanceData.homePerformance.matches : 0 }}</span>
                  </div>
                  <div class="context-stat wins">
                    <span class="stat-label">Victorias</span>
                    <span class="stat-value">{{ performanceData.homePerformance? performanceData.homePerformance.wins : 0 }}</span>
                  </div>
                  <div class="context-stat draws">
                    <span class="stat-label">Empates</span>
                    <span class="stat-value">{{ performanceData.homePerformance? performanceData.homePerformance.draws : 0}}</span>
                  </div>
                  <div class="context-stat losses">
                    <span class="stat-label">Derrotas</span>
                    <span class="stat-value">{{ performanceData.homePerformance ? performanceData.homePerformance.losses : 0 }}</span>
                  </div>
                  <div class="context-stat">
                    <span class="stat-label">Goles a Favor</span>
                    <span class="stat-value">{{ performanceData.homePerformance ? performanceData.homePerformance.goalsFor : 0 }}</span>
                  </div>
                  <div class="context-stat">
                    <span class="stat-label">Goles en Contra</span>
                    <span class="stat-value">{{ performanceData.homePerformance ? performanceData.homePerformance.goalsAgainst : 0 }}</span>
                  </div>
                </div>
                <div class="win-rate">
                  <span class="win-rate-label">Efectividad</span>
                  <span class="win-rate-value">{{ performanceData.homePerformance ? (performanceData.homePerformance.effectiveness | number:'1.0-0') : 0}}%</span>
                  <mat-progress-bar mode="determinate" [value]=" performanceData.homePerformance ? performanceData.homePerformance.effectiveness : 0" color="primary"></mat-progress-bar>
                </div>
              </div>

              <mat-divider [vertical]="true"></mat-divider>

              <!-- Away Stats -->
              <div class="context-section away">
                <div class="context-header">
                  <mat-icon>flight_takeoff</mat-icon>
                  <h3>Visitante</h3>
                </div>
                <div class="context-stats">
                  <div class="context-stat">
                    <span class="stat-label">Partidos</span>
                    <span class="stat-value">{{ performanceData.awayPerformance? performanceData.awayPerformance.matches : 0 }}</span>
                  </div>
                  <div class="context-stat wins">
                    <span class="stat-label">Victorias</span>
                    <span class="stat-value">{{ performanceData.awayPerformance?performanceData.awayPerformance.wins :0}}</span>
                  </div>
                  <div class="context-stat draws">
                    <span class="stat-label">Empates</span>
                    <span class="stat-value">{{performanceData.awayPerformance? performanceData.awayPerformance.draws : 0 }}</span>
                  </div>
                  <div class="context-stat losses">
                    <span class="stat-label">Derrotas</span>
                    <span class="stat-value">{{ performanceData.awayPerformance?performanceData.awayPerformance.losses:0 }}</span>
                  </div>
                  <div class="context-stat">
                    <span class="stat-label">Goles a Favor</span>
                    <span class="stat-value">{{performanceData.awayPerformance? performanceData.awayPerformance.goalsFor:0 }}</span>
                  </div>
                  <div class="context-stat">
                    <span class="stat-label">Goles en Contra</span>
                    <span class="stat-value">{{performanceData.awayPerformance?  performanceData.awayPerformance.goalsAgainst:0 }}</span>
                  </div>
                </div>
                <div class="win-rate">
                  <span class="win-rate-label">Efectividad</span>
                  <span class="win-rate-value">{{ performanceData.awayPerformance? (performanceData.awayPerformance.effectiveness | number:'1.0-0') :0 }}%</span>
                  <mat-progress-bar mode="determinate" [value]="performanceData.awayPerformance?performanceData.awayPerformance.effectiveness :0" color="accent"></mat-progress-bar>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Tournament Phases -->
        <mat-card class="phases-card">
          <mat-card-header>
            <mat-card-title>Rendimiento por Fase del Torneo</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="phases-list">
              <div *ngFor="let phase of performanceData.phasePerformance" class="phase-item">
                <div class="phase-header">
                  <h4>{{ phase.phaseName }}</h4>
                  <mat-chip-set>
                    <mat-chip>{{ phase.points }} pts</mat-chip>
                  </mat-chip-set>
                </div>
                <div class="phase-stats">
                  <div class="phase-stat">
                    <mat-icon>sports_soccer</mat-icon>
                    <span>{{ phase.played }} partidos</span>
                  </div>
                  <div class="phase-stat wins">
                    <mat-icon>check_circle</mat-icon>
                    <span>{{ phase.wins }} V</span>
                  </div>
                  <div class="phase-stat draws">
                    <mat-icon>remove_circle</mat-icon>
                    <span>{{ phase.draws }} E</span>
                  </div>
                  <div class="phase-stat losses">
                    <mat-icon>cancel</mat-icon>
                    <span>{{ phase.losses }} D</span>
                  </div>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Tab: Tendencias -->
    <mat-tab label="Tendencias">
      <div class="tab-content">
        <!-- Position Evolution -->
        <mat-card class="evolution-card">
          <mat-card-header>
            <mat-card-title>Evolución de Posición en Tabla</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="evolution-chart">
              <div class="chart-placeholder">
                <mat-icon>show_chart</mat-icon>
                <p>Gráfico de evolución de posición</p>
                <div class="position-list" *ngIf="performanceData.evolution">
                  <div *ngFor="let item of performanceData.evolution.evolution" class="position-item">
                    <span class="matchday">{{ item.matchDayName }}</span>
                    <div class="position-badge">
                      <span class="position">{{ item.position }}°</span>
                    </div>
                    <span class="points">{{ item.points }} pts</span>
                  </div>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Current Streak -->
        <mat-card class="streak-card">
          <mat-card-header>
            <mat-card-title>Racha Actual</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="streak-content">
              <div class="streak-icon" [style.background-color]="getStreakColor()">
                <mat-icon>{{ getStreakIcon() }}</mat-icon>
              </div>
              <div class="streak-info">
                <h3>{{ getStreakCount() }} {{ getStreakLabel() }} Consecutivas</h3>
                <div class="streak-matches">
                  <p>Racha actual del equipo</p>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Best/Worst Moments -->
        <div class="moments-grid">
          <mat-card class="moment-card best">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>emoji_events</mat-icon>
                Mejor Momento
              </mat-card-title>
            </mat-card-header>
            <mat-card-content *ngIf="performanceData.evolution">
              <h3>Jornadas {{ performanceData.evolution.bestMoment.startMatchDay }} - {{ performanceData.evolution.bestMoment.endMatchDay }}</h3>
              <p class="moment-description">Mejor momento del equipo</p>
              <div class="moment-stats">
                <div class="moment-stat">
                  <mat-icon>stars</mat-icon>
                  <span>{{ performanceData.evolution.bestMoment.points }} puntos</span>
                </div>
                <div class="moment-stat">
                  <mat-icon>sports_score</mat-icon>
                  <span>{{ performanceData.evolution.bestMoment.goalsFor }} goles a favor</span>
                </div>
                <div class="moment-stat">
                  <mat-icon>shield</mat-icon>
                  <span>{{ performanceData.evolution.bestMoment.goalsAgainst }} goles en contra</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="moment-card worst">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>warning</mat-icon>
                Momento Difícil
              </mat-card-title>
            </mat-card-header>
            <mat-card-content *ngIf="performanceData.evolution">
              <h3>Jornadas {{ performanceData.evolution.worstMoment.startMatchDay }} - {{ performanceData.evolution.worstMoment.endMatchDay }}</h3>
              <p class="moment-description">Momento difícil del equipo</p>
              <div class="moment-stats">
                <div class="moment-stat">
                  <mat-icon>stars</mat-icon>
                  <span>{{ performanceData.evolution.worstMoment.points }} puntos</span>
                </div>
                <div class="moment-stat">
                  <mat-icon>sports_score</mat-icon>
                  <span>{{ performanceData.evolution.worstMoment.goalsFor }} goles a favor</span>
                </div>
                <div class="moment-stat">
                  <mat-icon>shield</mat-icon>
                  <span>{{ performanceData.evolution.worstMoment.goalsAgainst }} goles en contra</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
