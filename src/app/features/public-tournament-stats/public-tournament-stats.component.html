<div class="public-tournament-stats-container">
  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p class="loading-text">Cargando estadÃ­sticas del torneo...</p>
  </div>

  <!-- Tournament Stats Content -->
  <div class="tournament-stats-content" *ngIf="!isLoading && records && stats">
    <!-- Hero Section -->
    <section class="hero-section">
      <!-- Background Image -->
      <div class="hero-background">
        <img src="assets/wallpaper.jpg" alt="Tournament Background" class="wallpaper-image">
        <div class="hero-overlay"></div>
      </div>

      <!-- Back Button -->
      <div class="back-button-container">
        <button mat-icon-button class="back-button" (click)="goBack()" matTooltip="Volver atrÃ¡s" matTooltipPosition="right">
          <mat-icon>arrow_back</mat-icon>
        </button>
      </div>

      <div class="container-fluid">
        <div class="row align-items-stretch">
          <!-- Left Column: Tournament Info (7 columns) -->
          <div class="col-lg-7">
            <div class="row align-items-center">
              <!-- Tournament Icon -->
              <div class="col-auto">
                <div class="tournament-icon-container">
                  <mat-icon class="tournament-icon-hero">analytics</mat-icon>
                </div>
              </div>

              <!-- Tournament Info -->
              <div class="col">
                <div class="tournament-info">
                  <div class="tournament-header">
                    <h1 class="tournament-title">EstadÃ­sticas del Torneo</h1>
                    <p class="tournament-subtitle">RÃ©cords, datos y anÃ¡lisis completo de la competiciÃ³n</p>
                  </div>
                  
                  <!-- Tournament Meta -->
                  <div class="tournament-meta-hero">
                    <div class="meta-item-hero">
                      <mat-icon>sports_soccer</mat-icon>
                      <span>{{ stats.totalMatches }} Partidos Jugados</span>
                    </div>
                    <div class="meta-item-hero">
                      <mat-icon>sports</mat-icon>
                      <span>{{ stats.totalGoals }} Goles Totales</span>
                    </div>
                    <div class="meta-item-hero">
                      <mat-icon>trending_up</mat-icon>
                      <span>{{ stats.averageGoalsPerMatch | number:'1.1-1' }} Goles/Partido</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Column: Quick Stats (5 columns) -->
          <div class="col-lg-5 hero-right-section px-0">
            <div class="hero-right-content">
              <!-- Primera Fila -->
              <div class="row g-2 mb-3">
                <!-- Total Goals -->
                <div class="col-6">
                  <div class="summary-section-mini goals">
                    <h4>
                      <mat-icon>sports_soccer</mat-icon>
                      Goles
                    </h4>
                    <div class="stat-display-mini">
                      <span class="number-mini">{{ stats.totalGoals }}</span>
                      <span class="label-mini">Total</span>
                    </div>
                    <div class="detail-mini">{{ stats.averageGoalsPerMatch | number:'1.1-1' }}/partido</div>
                  </div>
                </div>

                <!-- Cards -->
                <div class="col-6">
                  <div class="summary-section-mini cards">
                    <h4>
                      <mat-icon>style</mat-icon>
                      Tarjetas
                    </h4>
                    <div class="cards-stats-mini">
                      <div class="card-stat yellow">
                        <span class="number-mini">{{ stats.totalYellowCards }}</span>
                        <span class="label-mini">ðŸŸ¨</span>
                      </div>
                      <div class="card-stat red">
                        <span class="number-mini">{{ stats.totalRedCards }}</span>
                        <span class="label-mini">ðŸŸ¥</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Segunda Fila -->
              <div class="row g-2">
                <!-- Penalties -->
                <div class="col-6">
                  <div class="summary-section-mini penalties">
                    <h4>
                      <mat-icon>gps_fixed</mat-icon>
                      Penales
                    </h4>
                    <div class="stat-display-mini">
                      <span class="number-mini">{{ stats.totalPenalties }}</span>
                      <span class="label-mini">Total</span>
                    </div>
                    <div class="detail-mini">{{ (stats.totalPenalties / stats.totalMatches) | number:'1.1-1' }}/partido</div>
                  </div>
                </div>

                <!-- Home Advantage -->
                <div class="col-6">
                  <div class="summary-section-mini advantage">
                    <h4>
                      <mat-icon>home</mat-icon>
                      LocalÃ­a
                    </h4>
                    <div class="stat-display-mini">
                      <span class="number-mini">{{ stats.homeWinPercentage | number:'1.0-0' }}%</span>
                      <span class="label-mini">Victoria</span>
                    </div>
                    <div class="detail-mini">Factor cancha</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Content Section -->
    <div class="main-content-section">
      <div class="container-fluid">
        <div class="row">
          <!-- Left Column: Records & Top Scorers (8 columns) -->
          <div class="col-lg-8">
            <!-- Records Section -->
            <div class="records-section-main">
              <div class="section-header">
                <h3>
                  <mat-icon>emoji_events</mat-icon>
                  RÃ©cords del Torneo
                </h3>
              </div>
              
              <div class="tournament-records-grid">
                <!-- Biggest Win -->
                <div class="record-card-mini highlight">
                  <div class="record-icon-mini">
                    <mat-icon>sports_soccer</mat-icon>
                  </div>
                  <div class="record-content-mini">
                    <h4>Mayor Goleada</h4>
                    <p class="record-value-mini">{{ records.biggestWin.score }}</p>
                    <p class="record-detail-mini">{{ records.biggestWin.winner }} vs {{ records.biggestWin.loser }}</p>
                  </div>
                </div>

                <!-- Highest Scoring -->
                <div class="record-card-mini highlight">
                  <div class="record-icon-mini">
                    <mat-icon>whatshot</mat-icon>
                  </div>
                  <div class="record-content-mini">
                    <h4>MÃ¡s Goles</h4>
                    <p class="record-value-mini">{{ records.highestScoring.totalGoals }}</p>
                    <p class="record-detail-mini">{{ records.highestScoring.score }}</p>
                  </div>
                </div>

                <!-- Best Streak -->
                <div class="record-card-mini">
                  <div class="record-icon-mini">
                    <mat-icon>trending_up</mat-icon>
                  </div>
                  <div class="record-content-mini">
                    <h4>Mejor Racha</h4>
                    <p class="record-value-mini">{{ records.bestStreak.wins }}</p>
                    <p class="record-detail-mini">{{ records.bestStreak.team }}</p>
                  </div>
                </div>

                <!-- Best Defense -->
                <div class="record-card-mini">
                  <div class="record-icon-mini">
                    <mat-icon>shield</mat-icon>
                  </div>
                  <div class="record-content-mini">
                    <h4>Mejor Defensa</h4>
                    <p class="record-value-mini">{{ records.bestDefense.goalsAgainst }}</p>
                    <p class="record-detail-mini">{{ records.bestDefense.team }}</p>
                  </div>
                </div>

                <!-- Best Attack -->
                <div class="record-card-mini">
                  <div class="record-icon-mini">
                    <mat-icon>flash_on</mat-icon>
                  </div>
                  <div class="record-content-mini">
                    <h4>Mejor Ataque</h4>
                    <p class="record-value-mini">{{ records.bestAttack.goalsFor }}</p>
                    <p class="record-detail-mini">{{ records.bestAttack.team }}</p>
                  </div>
                </div>

                <!-- Fair Play Leader -->
                <div class="record-card-mini">
                  <div class="record-icon-mini">
                    <mat-icon>handshake</mat-icon>
                  </div>
                  <div class="record-content-mini">
                    <h4>Fair Play</h4>
                    <p class="record-detail-mini">{{ records.fairPlayLeader.team }}</p>
                    <div class="fair-play-mini">
                      <span>ðŸŸ¨{{ records.fairPlayLeader.yellowCards }}</span>
                      <span>ðŸŸ¥{{ records.fairPlayLeader.redCards }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Top Scorers Section -->
            <div class="scorers-section-main">
              <div class="section-header">
                <h3>
                  <mat-icon>emoji_events</mat-icon>
                  Tabla de Goleadores
                </h3>
              </div>
              
              <div class="scorers-list-mini">
                <div *ngFor="let scorer of topScorers.slice(0, 6); let i = index" 
                     class="scorer-item-mini"
                     [class.top1]="i === 0"
                     [class.top2]="i === 1"
                     [class.top3]="i === 2">
                  <div class="scorer-position-mini">
                    <span class="position-number-mini">{{ i + 1 }}</span>
                    <mat-icon *ngIf="i < 3" class="trophy-mini" [class]="'trophy-' + (i + 1)">emoji_events</mat-icon>
                  </div>
                  <div class="scorer-info-mini">
                    <span class="scorer-name-mini">{{ scorer.name }}</span>
                    <span class="scorer-team-mini">{{ scorer.team }}</span>
                  </div>
                  <div class="scorer-stats-mini">
                    <span class="goals-mini">{{ scorer.goals }} âš½</span>
                    <span class="matches-mini">{{ scorer.matches }} PJ</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Column: Charts & Analysis (4 columns) -->
          <div class="col-lg-4">
            <div class="right-column-content">
              <!-- Goals Chart Section -->
              <div class="chart-section-mini">
                <div class="section-header">
                  <h4>
                    <mat-icon>show_chart</mat-icon>
                    Goles por Jornada
                  </h4>
                </div>
                
                <div class="chart-mini-container">
                  <div class="chart-stats-mini">
                    <span>Max: {{ getMaxGoalsInMatchday() }}</span>
                    <span>Prom: {{ getAverageGoalsPerMatchday() | number:'1.1-1' }}</span>
                  </div>
                  <div class="bar-chart-mini">
                    <div *ngFor="let data of goalsPerMatchday.slice(0, 8)" class="bar-item-mini">
                      <div class="bar-mini" 
                           [style.height]="getBarWidth(data.goals, getMaxGoalsInMatchday())"
                           [style.background-color]="getBarColor(data.goals, getMaxGoalsInMatchday())"
                           [matTooltip]="data.goals + ' goles'">
                      </div>
                      <span class="bar-label-mini">J{{ data.matchday }}</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Result Distribution Section -->
              <div class="distribution-section-mini" *ngIf="resultDistribution">
                <div class="section-header">
                  <h4>
                    <mat-icon>pie_chart</mat-icon>
                    DistribuciÃ³n
                  </h4>
                </div>
                
                <div class="result-distribution-mini">
                  <div class="result-item-mini home">
                    <div class="result-info-mini">
                      <mat-icon>home</mat-icon>
                      <span class="result-label-mini">Local</span>
                    </div>
                    <div class="result-stats-mini">
                      <span class="result-value-mini">{{ resultDistribution.homeWins }}</span>
                      <span class="result-percentage-mini">{{ (resultDistribution.homeWins / stats.totalMatches * 100) | number:'1.0-0' }}%</span>
                    </div>
                  </div>
                  
                  <div class="result-item-mini draw">
                    <div class="result-info-mini">
                      <mat-icon>drag_handle</mat-icon>
                      <span class="result-label-mini">Empate</span>
                    </div>
                    <div class="result-stats-mini">
                      <span class="result-value-mini">{{ resultDistribution.draws }}</span>
                      <span class="result-percentage-mini">{{ (resultDistribution.draws / stats.totalMatches * 100) | number:'1.0-0' }}%</span>
                    </div>
                  </div>
                  
                  <div class="result-item-mini away">
                    <div class="result-info-mini">
                      <mat-icon>flight_takeoff</mat-icon>
                      <span class="result-label-mini">Visit.</span>
                    </div>
                    <div class="result-stats-mini">
                      <span class="result-value-mini">{{ resultDistribution.awayWins }}</span>
                      <span class="result-percentage-mini">{{ (resultDistribution.awayWins / stats.totalMatches * 100) | number:'1.0-0' }}%</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Key Insights Section -->
              <div class="insights-section-mini">
                <div class="section-header">
                  <h4>
                    <mat-icon>insights</mat-icon>
                    Datos Clave
                  </h4>
                </div>
                
                <div class="insights-grid-mini">
                  <div class="insight-item-mini">
                    <mat-icon>sports_soccer</mat-icon>
                    <div class="insight-content-mini">
                      <span class="insight-value-mini">{{ stats.averageGoalsPerMatch | number:'1.1-1' }}</span>
                      <span class="insight-label-mini">Goles/Partido</span>
                    </div>
                  </div>
                  
                  <div class="insight-item-mini">
                    <mat-icon>style</mat-icon>
                    <div class="insight-content-mini">
                      <span class="insight-value-mini">{{ ((stats.totalYellowCards + stats.totalRedCards) / stats.totalMatches) | number:'1.1-1' }}</span>
                      <span class="insight-label-mini">Tarjetas/Partido</span>
                    </div>
                  </div>
                  
                  <div class="insight-item-mini">
                    <mat-icon>home</mat-icon>
                    <div class="insight-content-mini">
                      <span class="insight-value-mini">{{ stats.homeWinPercentage | number:'1.0-0' }}%</span>
                      <span class="insight-label-mini">Factor Cancha</span>
                    </div>
                  </div>
                  
                  <div class="insight-item-mini">
                    <mat-icon>gps_fixed</mat-icon>
                    <div class="insight-content-mini">
                      <span class="insight-value-mini">{{ (stats.totalPenalties / stats.totalMatches) | number:'1.1-1' }}</span>
                      <span class="insight-label-mini">Penales/Partido</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
