<div class="public-tournament-stats-container">
  <!-- Loading State -->
  <app-public-loading 
    [isVisible]="isLoading"
    text="Cargando estadÃ­sticas..."
    subtext="Obteniendo datos y anÃ¡lisis del torneo"
    [diameter]="50"
    [strokeWidth]="3">
  </app-public-loading>

  <!-- Tournament Stats Content -->
  <div class="tournament-stats-content" *ngIf="!isLoading">
    <!-- Hero Section -->
    <section class="hero-section">
      <!-- Background Image -->
      <div class="hero-background">
        <img src="assets/wallpaper.jpg" alt="Tournament Background" class="wallpaper-image">
        <div class="hero-overlay"></div>
      </div>

      <!-- Back Button -->
      <div class="back-button-container">
        <button mat-icon-button class="back-button" (click)="goBack()" matTooltip="Volver atrÃ¡s" matTooltipPosition="right">
          <mat-icon>arrow_back</mat-icon>
        </button>
      </div>

      <div class="container-fluid">
        <div class="row align-items-stretch">
          <!-- Left Column: Tournament Info (7 columns) -->
          <div class="col-lg-7">
            <div class="row align-items-center">
              <!-- Tournament Icon -->
              <div class="col-auto">
                <div class="tournament-icon-container">
                  <mat-icon class="tournament-icon-hero">analytics</mat-icon>
                </div>
              </div>

              <!-- Tournament Info -->
              <div class="col">
                <div class="tournament-info">
                  <div class="tournament-header">
                    <h1 class="tournament-title">EstadÃ­sticas del Torneo</h1>
                    <p class="tournament-subtitle">RÃ©cords, datos y anÃ¡lisis completo de la competiciÃ³n</p>
                  </div>
                  
                  <!-- Tournament Meta -->
                  <div class="tournament-meta-hero">
                    <div class="meta-item-hero">
                      <mat-icon>sports_soccer</mat-icon>
                      <span>{{ stats.totalMatches || 0 }} Partidos Jugados</span>
                    </div>
                    <div class="meta-item-hero">
                      <mat-icon>sports</mat-icon>
                      <span>{{ stats.totalGoals || 0 }} Goles Totales</span>
                    </div>
                    <div class="meta-item-hero">
                      <mat-icon>trending_up</mat-icon>
                      <span>{{ (stats.averageGoalsPerMatch || 0) | number:'1.1-1' }} Goles/Partido</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Column: Filters & Quick Stats (5 columns) -->
          <div class="col-lg-5 hero-right-section px-0">
            <div class="hero-right-content">
              
              <!-- Filters Card -->
              <mat-card class="filters-card-hero" *ngIf="phases.length > 0">
                <mat-card-content>
                  <!-- Filters Row -->
                  <div class="filters-row">
                    <div class="row g-2">
                      <div [class]="shouldShowGroupSelect ? 'col-6' : 'col-12'">
                        <mat-form-field appearance="outline" class="filter-select">
                          <mat-label>Fase del Torneo</mat-label>
                          <mat-select [(ngModel)]="selectedPhaseId" (selectionChange)="onPhaseChange()">
                            <mat-option *ngFor="let phase of phases" [value]="phase.id">
                              <mat-icon class="option-icon">
                                {{ phase.phaseType === PhaseType.Groups ? 'groups' : 'emoji_events' }}
                              </mat-icon>
                              {{ phase.name }}
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div class="col-6" *ngIf="shouldShowGroupSelect">
                        <mat-form-field appearance="outline" class="filter-select">
                          <mat-label>Grupo</mat-label>
                          <mat-select [(ngModel)]="selectedGroupId" (selectionChange)="onGroupChange()">
                            <mat-option *ngFor="let group of groups" [value]="group.id">
                              <mat-icon class="option-icon">flag</mat-icon>
                              {{ group.name }}
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                    </div>
                  </div>
                </mat-card-content>
              </mat-card>
              <!-- Primera Fila -->
              <div class="row g-2 mb-3">
                <!-- Total Goals -->
                <div class="col-6">
                  <div class="summary-section-mini goals">
                    <h4>
                      <mat-icon>sports_soccer</mat-icon>
                      Goles
                    </h4>
                    <div class="stat-display-mini">
                      <span class="number-mini">{{ stats.totalGoals || 0 }}</span>
                      <span class="label-mini">Total</span>
                    </div>
                    <div class="detail-mini">{{ (stats.averageGoalsPerMatch || 0) | number:'1.1-1' }}/partido</div>
                  </div>
                </div>

                <!-- Cards -->
                <div class="col-6">
                  <div class="summary-section-mini cards">
                    <h4>
                      <mat-icon>style</mat-icon>
                      Tarjetas
                    </h4>
                    <div class="cards-stats-mini">
                      <div class="card-stat yellow">
                        <span class="number-mini">{{ stats.totalYellowCards || 0 }}</span>
                        <span class="label-mini">ðŸŸ¨</span>
                      </div>
                      <div class="card-stat red">
                        <span class="number-mini">{{ stats.totalRedCards || 0 }}</span>
                        <span class="label-mini">ðŸŸ¥</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Segunda Fila -->
              <div class="row g-2">
                <!-- Penalties -->
                <div class="col-6">
                  <div class="summary-section-mini penalties">
                    <h4>
                      <mat-icon>gps_fixed</mat-icon>
                      Penales
                    </h4>
                    <div class="stat-display-mini">
                      <span class="number-mini">{{ stats.totalPenalties || 0 }}</span>
                      <span class="label-mini">Total</span>
                    </div>
                    <div class="detail-mini">{{ ((stats.totalPenalties || 0) / (stats.totalMatches || 1)) | number:'1.1-1' }}/partido</div>
                  </div>
                </div>

                <!-- Home Advantage -->
                <div class="col-6">
                  <div class="summary-section-mini advantage">
                    <h4>
                      <mat-icon>home</mat-icon>
                      LocalÃ­a
                    </h4>
                    <div class="stat-display-mini">
                      <span class="number-mini">{{ (stats.homeWinPercentage || 0) | number:'1.0-0' }}%</span>
                      <span class="label-mini">Victoria</span>
                    </div>
                    <div class="detail-mini">Factor cancha</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Content Section -->
    <div class="main-content-section">
      <div class="container-fluid">
        <div class="row">
          <!-- Left Column: Records & Top Scorers (8 columns) -->
          <div class="col-lg-8">
            <!-- Records Section -->
            <div class="records-section-main" *ngIf="records">
              <div class="section-header">
                <h3>
                  <mat-icon>emoji_events</mat-icon>
                  RÃ©cords del Torneo
                </h3>
              </div>
              
              <div class="tournament-records-grid">
                <!-- Biggest Win -->
                <div class="record-card-mini highlight">
                  <div class="record-icon-mini">
                    <mat-icon>sports_soccer</mat-icon>
                  </div>
                  <div class="record-content-mini">
                    <h4>Mayor Goleada</h4>
                    <p class="record-value-mini">{{ records.biggestWin.score || 'N/A' }}</p>
                    <p class="record-detail-mini">{{ records.biggestWin.winner || 'Sin datos' }} vs {{ records.biggestWin.loser || 'Sin datos' }}</p>
                  </div>
                </div>

                <!-- Highest Scoring -->
                <div class="record-card-mini highlight">
                  <div class="record-icon-mini">
                    <mat-icon>whatshot</mat-icon>
                  </div>
                  <div class="record-content-mini">
                    <h4>MÃ¡s Goles</h4>
                    <p class="record-value-mini">{{ records.highestScoring.totalGoals || 0 }}</p>
                    <p class="record-detail-mini">{{ records.highestScoring.score || 'N/A' }}</p>
                  </div>
                </div>

                <!-- Best Streak -->
                <div class="record-card-mini">
                  <div class="record-icon-mini">
                    <mat-icon>trending_up</mat-icon>
                  </div>
                  <div class="record-content-mini">
                    <h4>Mejor Racha</h4>
                    <p class="record-value-mini">{{ records.bestStreak.wins || 0 }}</p>
                    <p class="record-detail-mini">{{ records.bestStreak.team || 'Sin datos' }}</p>
                  </div>
                </div>

                <!-- Best Defense -->
                <div class="record-card-mini">
                  <div class="record-icon-mini">
                    <mat-icon>shield</mat-icon>
                  </div>
                  <div class="record-content-mini">
                    <h4>Mejor Defensa</h4>
                    <p class="record-value-mini">{{ records.bestDefense.goalsAgainst || 0 }}</p>
                    <p class="record-detail-mini">{{ records.bestDefense.team || 'Sin datos' }}</p>
                  </div>
                </div>

                <!-- Best Attack -->
                <div class="record-card-mini">
                  <div class="record-icon-mini">
                    <mat-icon>flash_on</mat-icon>
                  </div>
                  <div class="record-content-mini">
                    <h4>Mejor Ataque</h4>
                    <p class="record-value-mini">{{ records.bestAttack.goalsFor || 0 }}</p>
                    <p class="record-detail-mini">{{ records.bestAttack.team || 'Sin datos' }}</p>
                  </div>
                </div>

                <!-- Fair Play Leader -->
                <div class="record-card-mini">
                  <div class="record-icon-mini">
                    <mat-icon>handshake</mat-icon>
                  </div>
                  <div class="record-content-mini">
                    <h4>Fair Play</h4>
                    <p class="record-detail-mini">{{ records.fairPlayLeader.team || 'Sin datos' }}</p>
                    <div class="fair-play-mini">
                      <span>ðŸŸ¨{{ records.fairPlayLeader.yellowCards || 0 }}</span>
                      <span>ðŸŸ¥{{ records.fairPlayLeader.redCards || 0 }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Top Scorers Section -->
            <div class="scorers-section-main" *ngIf="topScorers && topScorers.length > 0">
              <div class="section-header">
                <h3>
                  <mat-icon>emoji_events</mat-icon>
                  Tabla de Goleadores
                </h3>
              </div>
              
              <div class="scorers-list-mini">
                <div *ngFor="let scorer of topScorers.slice(0, 6); let i = index" 
                     class="scorer-item-mini"
                     [class.top1]="i === 0"
                     [class.top2]="i === 1"
                     [class.top3]="i === 2">
                  <div class="scorer-position-mini">
                    <span class="position-number-mini">{{ i + 1 }}</span>
                    <mat-icon *ngIf="i < 3" class="trophy-mini" [class]="'trophy-' + (i + 1)">emoji_events</mat-icon>
                  </div>
                  <div class="scorer-info-mini">
                    <span class="scorer-name-mini">{{ scorer.name }}</span>
                    <span class="scorer-team-mini">{{ scorer.team }}</span>
                  </div>
                  <div class="scorer-stats-mini">
                    <span class="goals-mini">{{ scorer.goals }} âš½</span>
                    <span class="matches-mini">{{ scorer.matches }} PJ</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Column: Charts & Analysis (4 columns) -->
          <div class="col-lg-4">
            <div class="right-column-content">
              <!-- Goals Chart Section -->
              <div class="chart-section-mini">
                <div class="section-header">
                  <h4>
                    <mat-icon>show_chart</mat-icon>
                    Goles por Jornada
                  </h4>
                </div>
                
                <div class="chart-mini-container">
                  <div class="chart-stats-mini">
                    <span>Max: {{ getMaxGoalsInMatchday() }}</span>
                    <span>Prom: {{ getAverageGoalsPerMatchday() | number:'1.1-1' }}</span>
                  </div>
                  <div class="bar-chart-mini">
                    <div *ngFor="let data of goalsPerMatchday.slice(0, 8)" class="bar-item-mini">
                      <div class="bar-mini" 
                           [style.height]="getBarWidth(data.goals, getMaxGoalsInMatchday())"
                           [style.background-color]="getBarColor(data.goals, getMaxGoalsInMatchday())"
                           [matTooltip]="data.goals + ' goles'">
                      </div>
                      <span class="bar-label-mini">J{{ data.matchday }}</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Result Distribution Section -->
              <div class="distribution-section-mini" *ngIf="resultDistribution">
                <div class="section-header">
                  <h4>
                    <mat-icon>pie_chart</mat-icon>
                    DistribuciÃ³n
                  </h4>
                </div>
                
                <div class="result-distribution-mini">
                  <div class="result-item-mini home">
                    <div class="result-info-mini">
                      <mat-icon>home</mat-icon>
                      <span class="result-label-mini">Local</span>
                    </div>
                    <div class="result-stats-mini">
                      <span class="result-value-mini">{{ resultDistribution.homeWins || 0 }}</span>
                      <span class="result-percentage-mini">{{ ((resultDistribution.homeWins || 0) / (stats.totalMatches || 1) * 100) | number:'1.0-0' }}%</span>
                    </div>
                  </div>
                  
                  <div class="result-item-mini draw">
                    <div class="result-info-mini">
                      <mat-icon>drag_handle</mat-icon>
                      <span class="result-label-mini">Empate</span>
                    </div>
                    <div class="result-stats-mini">
                      <span class="result-value-mini">{{ resultDistribution.draws || 0 }}</span>
                      <span class="result-percentage-mini">{{ ((resultDistribution.draws || 0) / (stats.totalMatches || 1) * 100) | number:'1.0-0' }}%</span>
                    </div>
                  </div>
                  
                  <div class="result-item-mini away">
                    <div class="result-info-mini">
                      <mat-icon>flight_takeoff</mat-icon>
                      <span class="result-label-mini">Visit.</span>
                    </div>
                    <div class="result-stats-mini">
                      <span class="result-value-mini">{{ resultDistribution.awayWins || 0 }}</span>
                      <span class="result-percentage-mini">{{ ((resultDistribution.awayWins || 0) / (stats.totalMatches || 1) * 100) | number:'1.0-0' }}%</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Key Insights Section -->
              <div class="insights-section-mini">
                <div class="section-header">
                  <h4>
                    <mat-icon>insights</mat-icon>
                    Datos Clave
                  </h4>
                </div>
                
                <div class="insights-grid-mini">
                  <div class="insight-item-mini">
                    <mat-icon>sports_soccer</mat-icon>
                    <div class="insight-content-mini">
                      <span class="insight-value-mini">{{ (stats.averageGoalsPerMatch || 0) | number:'1.1-1' }}</span>
                      <span class="insight-label-mini">Goles/Partido</span>
                    </div>
                  </div>
                  
                  <div class="insight-item-mini">
                    <mat-icon>style</mat-icon>
                    <div class="insight-content-mini">
                      <span class="insight-value-mini">{{ (((stats.totalYellowCards || 0) + (stats.totalRedCards || 0)) / (stats.totalMatches || 1)) | number:'1.1-1' }}</span>
                      <span class="insight-label-mini">Tarjetas/Partido</span>
                    </div>
                  </div>
                  
                  <div class="insight-item-mini">
                    <mat-icon>home</mat-icon>
                    <div class="insight-content-mini">
                      <span class="insight-value-mini">{{ (stats.homeWinPercentage || 0) | number:'1.0-0' }}%</span>
                      <span class="insight-label-mini">Factor Cancha</span>
                    </div>
                  </div>
                  
                  <div class="insight-item-mini">
                    <mat-icon>gps_fixed</mat-icon>
                    <div class="insight-content-mini">
                      <span class="insight-value-mini">{{ ((stats.totalPenalties || 0) / (stats.totalMatches || 1)) | number:'1.1-1' }}</span>
                      <span class="insight-label-mini">Penales/Partido</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
