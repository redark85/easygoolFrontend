<div class="top-scorers-container">
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="hero-background">
      <img src="assets/wallpaper.jpg" alt="Background" class="wallpaper-image">
      <div class="hero-overlay"></div>
    </div>

    <!-- Back Button -->
    <div class="back-button-container">
      <button mat-icon-button class="back-button" (click)="goBack()" matTooltip="Volver atrás" matTooltipPosition="right">
        <mat-icon>arrow_back</mat-icon>
      </button>
    </div>

    <div class="container-fluid">
      <div class="row align-items-stretch">
        <!-- Left Column: Top Scorers Info (8 columns) -->
        <div class="col-lg-8">
          <div class="row align-items-center">
            <!-- Top Scorers Icon -->
            <div class="col-auto">
              <div class="fixture-icon-container">
                <mat-icon class="fixture-main-icon">emoji_events</mat-icon>
              </div>
            </div>

            <!-- Top Scorers Info -->
            <div class="col">
              <div class="fixture-info">
                <div class="fixture-header">
                  <h1 class="fixture-title">Estadísticas de Jugadores</h1>
                  <p class="fixture-subtitle">Goleadores y Tarjetas del Torneo</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Legend Row - Movido aquí desde la columna derecha -->
          <div class="row mt-3">
            <div class="col-12">
              <div class="legend-items-hero">
                <div class="legend-item-hero">
                  <div class="legend-badge">
                    <mat-icon>sports_soccer</mat-icon>
                    PJ: Partidos Jugados
                  </div>
                </div>
                <div class="legend-item-hero">
                  <div class="legend-badge">
                    <mat-icon>trending_up</mat-icon>
                    Asist.: Asistencias
                  </div>
                </div>
                <div class="legend-item-hero">
                  <div class="legend-badge">
                    <mat-icon>analytics</mat-icon>
                    Prom.: Promedio de goles por partido
                  </div>
                </div>
                <div class="legend-item-hero">
                  <div class="legend-badge">
                    <mat-icon>star</mat-icon>
                    MOTM: Man of the Match
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column: Filters (4 columns) -->
        <div class="col-lg-4 hero-right-section">
          <div class="hero-right-content">
            <!-- Filters Card -->
            <mat-card class="filters-card-hero">
              <mat-card-content>
                <!-- Filters Row -->
                <div class="filters-row">
                  <div class="row g-2">
                    <div [class]="shouldShowGroupSelect ? 'col-6' : 'col-12'">
                      <mat-form-field appearance="outline" class="filter-select">
                        <mat-label>Fase del Torneo</mat-label>
                        <mat-select [(ngModel)]="selectedPhaseId" (selectionChange)="onPhaseChange()">
                          <mat-option *ngFor="let phase of phases" [value]="phase.id">
                            <mat-icon class="option-icon">
                              {{ phase.phaseType === PhaseType.Groups ? 'groups' : 'emoji_events' }}
                            </mat-icon>
                            {{ phase.name }}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <div class="col-6" *ngIf="shouldShowGroupSelect">
                      <mat-form-field appearance="outline" class="filter-select">
                        <mat-label>Grupo</mat-label>
                        <mat-select [(ngModel)]="selectedGroupId" (selectionChange)="onGroupChange()">
                          <mat-option *ngFor="let group of groups" [value]="group.id">
                            <mat-icon class="option-icon">flag</mat-icon>
                            {{ group.name }}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Loading State -->
  <app-public-loading
    [isVisible]="isLoading"
    text="Cargando estadísticas..."
    subtext="Obteniendo goleadores y tarjetas del torneo"
    [diameter]="50"
    [strokeWidth]="3">
  </app-public-loading>

  <!-- Tables Content -->
  <div class="container-fluid tables-section" *ngIf="!isLoading">
    <div class="row">

      <!-- Left Column: Goleadores (6 columns) -->
      <div class="col-md-6">
        <mat-card class="table-card scorers-card">
          <mat-card-content>
            <div class="table-header">
              <h2>
                <mat-icon>sports_soccer</mat-icon>
                Tabla de Goleadores
              </h2>
              <p class="subtitle">Los máximos artilleros del torneo</p>
            </div>

            <div class="table-container">
              <!-- Empty State para Goleadores -->
              <div class="empty-state" *ngIf="!isLoading && topScorers.length === 0">
                <h3>No hay goleadores</h3>
                <p>No se encontraron goleadores para los filtros seleccionados</p>
              </div>

              <table mat-table [dataSource]="topScorers" class="scorers-table" *ngIf="topScorers.length > 0">

                <!-- Position Column -->
                <ng-container matColumnDef="position">
                  <th mat-header-cell *matHeaderCellDef>Pos</th>
                  <td mat-cell *matCellDef="let scorer">
                    <span class="position-badge" [ngClass]="getPositionClass(scorer.position)">
                      <mat-icon *ngIf="isTop3(scorer.position)" class="medal-icon">
                        {{ scorer.position === 1 ? 'emoji_events' : 'military_tech' }}
                      </mat-icon>
                      {{ scorer.position }}
                    </span>
                  </td>
                </ng-container>

                <!-- Player Column -->
                <ng-container matColumnDef="player">
                  <th mat-header-cell *matHeaderCellDef>Jugador</th>
                  <td mat-cell *matCellDef="let scorer" class="player-cell">
                    <div class="player-info" (click)="viewPlayerDetail(scorer.name)">
                      <img [src]="scorer.imageUrl ?? 'assets/person.jpg'"
                           [alt]="scorer.name"
                           class="player-photo"
                           onerror="this.src='assets/person.jpg'">
                      <div class="player-details">
                        <div class="player-name">{{ scorer.name }}</div>
                        <div class="team-info">
                          <img [src]="scorer.teamLogoUrl"
                               [alt]="scorer.teamName"
                               class="team-logo"
                               onerror="this.src='assets/team-placeholder.png'">
                          <span class="team-name">{{ scorer.teamName }}</span>
                        </div>
                      </div>
                    </div>
                  </td>
                </ng-container>

                <!-- Goals Column -->
                <ng-container matColumnDef="goals">
                  <th mat-header-cell *matHeaderCellDef>Goles</th>
                  <td mat-cell *matCellDef="let scorer">
                    <span class="goals-badge">
                      <mat-icon>sports_soccer</mat-icon>
                      {{ scorer.goals }}
                    </span>
                     <span class="penalty-info" *ngIf="scorer.penaltyGoals > 0" 
                        [matTooltip]="scorer.penaltyGoals + ' penaltis'">
                    ({{ scorer.penaltyGoals }})
                  </span>

                  </td>
                </ng-container>


                <!-- Matches Column -->
                <ng-container matColumnDef="matches">
                  <th mat-header-cell *matHeaderCellDef>PJ</th>
                  <td mat-cell *matCellDef="let scorer" class="matches-col">
                    {{ scorer.matchesPlayed }}
                  </td>
                </ng-container>

                <!-- Average Column -->
                <ng-container matColumnDef="average">
                  <th mat-header-cell *matHeaderCellDef>Prom.</th>
                  <td mat-cell *matCellDef="let scorer" class="average-col">
                    <mat-chip class="average-chip">
                      {{ formatGoalAverage(scorer.goalAverage) }}
                    </mat-chip>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="scorersColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: scorersColumns;" class="scorer-row"></tr>
              </table>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Right Column: Tarjetas (6 columns) -->
      <div class="col-md-6">
        <mat-card class="table-card cards-card">
          <mat-card-content>
            <div class="table-header">
              <h2>
                <mat-icon>square</mat-icon>
                Tabla de Tarjetas
              </h2>
              <p class="subtitle">Jugadores más amonestados del torneo</p>
            </div>

            <div class="table-container">
              <!-- Empty State para Tarjetas -->
              <div class="empty-state" *ngIf="!isLoading && cardPlayers.length === 0">
                <h3>No hay tarjetas</h3>
                <p>No se encontraron tarjetas para los filtros seleccionados</p>
              </div>

              <table mat-table [dataSource]="cardPlayers" class="cards-table" *ngIf="cardPlayers.length > 0">

                <!-- Position Column -->
                <ng-container matColumnDef="position">
                  <th mat-header-cell *matHeaderCellDef>Pos</th>
                  <td mat-cell *matCellDef="let card">
                    <span class="position-badge warning">
                      {{ card.position }}
                    </span>
                  </td>
                </ng-container>

                <!-- Player Column -->
                <ng-container matColumnDef="player">
                  <th mat-header-cell *matHeaderCellDef>Jugador</th>
                  <td mat-cell *matCellDef="let card" class="player-cell">
                    <div class="player-info" (click)="viewPlayerDetail(card.name)">
                      <img [src]="card.imageUrl ?? 'assets/person.jpg'"
                           [alt]="card.name"
                           class="player-photo"
                           onerror="this.src='assets/person.jpg'">
                      <div class="player-details">
                        <div class="player-name">{{ card.name }}</div>
                        <div class="team-info">
                          <img [src]="card.teamLogoUrl"
                               [alt]="card.teamName"
                               class="team-logo"
                               onerror="this.src='assets/team-placeholder.png'">
                          <span class="team-name">{{ card.teamName }}</span>
                        </div>
                      </div>
                    </div>
                  </td>
                </ng-container>

                <!-- Yellow Cards Column -->
                <ng-container matColumnDef="yellow">
                  <th mat-header-cell *matHeaderCellDef>
                    <mat-icon class="yellow-icon">square</mat-icon>
                  </th>
                  <td mat-cell *matCellDef="let card" class="yellow-col">
                    <span class="card-count yellow">{{ card.yellowCards }}</span>
                  </td>
                </ng-container>

                <!-- Red Cards Column -->
                <ng-container matColumnDef="red">
                  <th mat-header-cell *matHeaderCellDef>
                    <mat-icon class="red-icon">square</mat-icon>
                  </th>
                  <td mat-cell *matCellDef="let card" class="red-col">
                    <span class="card-count red">{{ card.redCards }}</span>
                  </td>
                </ng-container>

                <!-- Total Cards Column -->
                <ng-container matColumnDef="total">
                  <th mat-header-cell *matHeaderCellDef>Total</th>
                  <td mat-cell *matCellDef="let card" class="total-col">
                    <strong>{{ card.totalCards }}</strong>
                  </td>
                </ng-container>

                <!-- Matches Column -->
                <ng-container matColumnDef="matches">
                  <th mat-header-cell *matHeaderCellDef>PJ</th>
                  <td mat-cell *matCellDef="let card" class="matches-col">
                    {{ card.matchesPlayed }}
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="cardsColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: cardsColumns;" class="card-row"></tr>
              </table>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

    </div>
  </div>

</div>
